{"version":3,"sources":["music.js","dateSelector.js"],"names":[],"mappings":"AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AC9LA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"music.js","sourcesContent":["$(document).ready(function() {\r\n    /**\r\n     * 点击新建按钮\r\n     */\r\n    $(\"#createMusic\").click(function() {\r\n        ajaxSubmitForm();\r\n        function ajaxSubmitForm() {\r\n           var value = $(\"#midi-file\").val();\r\n           if (isEmpty(value)) {\r\n               alert(\"请先选择文件\");\r\n               return false;\r\n           }\r\n           function isEmpty( inputStr ) {\r\n               if ( null == inputStr || \"\" == inputStr ) {\r\n                   return true;\r\n               }\r\n               return false;\r\n            }\r\n           if (!value.match(/.mid/i)) {\r\n               alert(\"文件格式错误\");\r\n               return false;\r\n           }\r\n           var option = {\r\n               url : 'music',\r\n               type : 'POST',\r\n               dataType : 'json',\r\n               data: {\r\n                   'name': $(\"#title\").val(),\r\n                   'author': $(\"#author\").val()\r\n               },\r\n               headers : {\r\n                //    \"ClientCallMode\" : \"ajax\"\r\n                   'X-CSRF-TOKEN': $('input[name=\"_token\"]').val()\r\n               }, //添加请求头部\r\n               success : function(data) {\r\n                   $(\"#addResult\").html(\"添加成功\");\r\n                   $(\"#addResult\").hide('slow', function() {\r\n\r\n                   });\r\n\r\n               },\r\n               error : function(data) {\r\n                   alert(JSON.stringify(data) + \"--上传失败,请刷新后重试\");\r\n               }\r\n           };\r\n           $(\"#add_music\").ajaxSubmit(option);\r\n           return false; //最好返回false，因为如果按钮类型是submit,则表单自己又会提交一次;返回false阻止表单再次提交\r\n        }\r\n    });\r\n\r\n    // 点击\"编辑\"按钮\r\n    $(\".edit\").each(function(index, el) {\r\n        $(this).click(function() {\r\n            $(\"#edit_id\").val($(el).closest('tr').attr('id'));\r\n            $(\"#edit_title\").val($(el).closest('tr').find('td:eq(0)').text());\r\n            $(\"#edit_author\").val($(el).closest('tr').find('td:eq(1)').text());\r\n        });\r\n    });\r\n\r\n    // 点击\"保存修改\"按钮\r\n    $(\"#save\").bind('click', function(event) {\r\n        ajaxSubmitForm();\r\n        function ajaxSubmitForm() {\r\n            var $id_value = $(\"#edit_id\").val();\r\n            var option = {\r\n                url : 'music/' + $id_value,\r\n                type : 'put',\r\n                dataType : 'json',\r\n                data : {\r\n                    'name' : $(\"#edit_title\").val(),\r\n                    'author' : $(\"#edit_author\").val()\r\n                },\r\n                headers : {\r\n                    'X-CSRF-TOKEN': $('input[name=\"_token\"]').val()\r\n                },\r\n                success : function(data) {\r\n                    $(\"#addResult\").html(\"修改成功!\");\r\n                },\r\n                error : function(data) {\r\n                    alert('哦，出了点小问题，再试一次吧');\r\n                }\r\n                // error : function(data) {\r\n                //     alert(JSON.stringify(data) + \"--添加失败, 请重试\");\r\n                // }\r\n            }\r\n            $(\"#save_detail\").ajaxSubmit(option);\r\n            return false;\r\n        }\r\n    });\r\n\r\n    // 点击\"删除\"按钮\r\n    $(\".delete\").each(function(indel, el) {\r\n        $(this).bind('click', function(event) {\r\n            $.ajax({\r\n                url: '/music/' + $(el).closest('tr').attr('id'),\r\n                type: 'DELETE',\r\n                dataType: 'json',\r\n                headers : {\r\n                    'X-CSRF-TOKEN': $('input[name=\"_token\"]').val()\r\n                }\r\n            })\r\n            .done(function() {\r\n                console.log(\"success\");\r\n                $(el).closest('tr').remove();\r\n\r\n            })\r\n            .fail(function() {\r\n                console.log(\"error\");\r\n            })\r\n            .always(function() {\r\n                console.log(\"complete\");\r\n            });\r\n        });\r\n    });\r\n\r\n    /**\r\n     * 自动拉取筛选条件列表\r\n     */\r\n    $.ajax({\r\n        url: '/music/condations',\r\n        type: 'GET',\r\n        dataType: 'json',\r\n        headers : {\r\n            'X-CSRF-TOKEN': $('input[name=\"_token\"]').val()\r\n        }\r\n    })\r\n    .done(function(data) {\r\n        /**\r\n         * 拉取“乐器”列表\r\n         */\r\n        $.each(data.instrument, function(n, value) {\r\n            var $str = \"\";\r\n            $str = \"<option value=\" + value.id + \">\" + value.name + \"</option>\";\r\n            $(\"#instrument\").append($str);\r\n        });\r\n\r\n        /**\r\n         * 拉取“出版社”列表\r\n         */\r\n        $.each(data.press, function(n, value) {\r\n            var $str = \"\";\r\n            $str = \"<option value=\" + value.id + \">\" + value.name + \"</option>\";\r\n            $(\"#press\").append($str);\r\n        });\r\n\r\n        /**\r\n         * 拉取\"乐曲类别\"列表\r\n         */\r\n        $.each(data.tag, function(n, value) {\r\n            var $str = \"\";\r\n            $str = \"<option value=\" + value.id + \">\" + value.name + \"</option>\";\r\n            $(\"#category\").append($str);\r\n        });\r\n    })\r\n    .fail(function(data) {\r\n        console.log(data);\r\n    });\r\n\r\n    /**\r\n     * select下拉式日期选择器\r\n     */\r\n     var myDate = new Date();\r\n     $(\"#dateSelector\").DateSelector({\r\n     ctlYearId: 'idYear',\r\n     ctlMonthId: 'idMonth',\r\n     ctlDayId: 'idDay',\r\n     defYear: myDate.getFullYear(),\r\n     defMonth: (myDate.getMonth() + 1),\r\n     defDay: myDate.getDate(),\r\n     minYear: 1800,\r\n     maxYear: (myDate.getFullYear() + 1)\r\n     });\r\n\r\n    /**\r\n     * 按筛选条件搜索\r\n     */\r\n    $(\"#date\").val($(\"#idYear\").val() + '-' + $(\"#idMonth\").val() + '-' + $(\"#idDay\").val());\r\n    $(\"select\").each(function(index, el) {\r\n        $(el).bind('change', function() {\r\n            // $(el).closest('input').val($(el).val());\r\n            $(el).siblings('input').val($(el).val());\r\n            if ($(el).attr('id') === 'idYear' || $(el).attr('id') === 'idMonth' || $(el).attr('id') === 'idDay') {\r\n                $(\"#date\").val($(\"#idYear\").val() + '-' + $(\"#idMonth\").val() + '-' + $(\"#idDay\").val());\r\n            }\r\n            console.log($(el).val());\r\n        });\r\n    });\r\n\r\n\r\n});\r\n","/*\r\n* jQuery Date Selector Plugin\r\n* 日期联动选择插件\r\n* \r\n* Demo:\r\n$(\"#calendar\").DateSelector({\r\nctlYearId: <年控件id>,\r\nctlMonthId: <月控件id>,\r\nctlDayId: <日控件id>,\r\ndefYear: <默认年>,\r\ndefMonth: <默认月>,\r\ndefDay: <默认日>,\r\nminYear: <最小年|默认为1882年>,\r\nmaxYear: <最大年|默认为本年>\r\n});\r\n\r\nHTML:<div id=\"calendar\"><SELECT id=idYear></SELECT>年 <SELECT id=idMonth></SELECT>月 <SELECT id=idDay></SELECT>日</div>\r\n*/\r\n(function ($) {\r\n    //SELECT控件设置函数\r\n    function setSelectControl(oSelect, iStart, iLength, iIndex) {\r\n        oSelect.empty();\r\n        for (var i = 0; i < iLength; i++) {\r\n            if ((parseInt(iStart) + i) == iIndex)\r\n                oSelect.append(\"<option selected='selected' value='\" + (parseInt(iStart) + i) + \"'>\" + (parseInt(iStart) + i) + \"</option>\");\r\n            else\r\n                oSelect.append(\"<option value='\" + (parseInt(iStart) + i) + \"'>\" + (parseInt(iStart) + i) + \"</option>\");\r\n        }\r\n    }\r\n\r\n    $.fn.DateSelector = function (options) {\r\n        options = options || {};\r\n\r\n        //初始化\r\n        this._options = {\r\n            ctlYearId: null,\r\n            ctlMonthId: null,\r\n            ctlDayId: null,\r\n            defYear: 0,\r\n            defMonth: 0,\r\n            defDay: 0,\r\n            minYear: 1882,\r\n            maxYear: new Date().getFullYear()\r\n        }\r\n\r\n        for (var property in options) {\r\n            this._options[property] = options[property];\r\n        }\r\n\r\n        this.yearValueId = $(\"#\" + this._options.ctlYearId);\r\n        this.monthValueId = $(\"#\" + this._options.ctlMonthId);\r\n        this.dayValueId = $(\"#\" + this._options.ctlDayId);\r\n\r\n        var dt = new Date(),\r\n        iMonth = parseInt(this.monthValueId.attr(\"data\") || this._options.defMonth),\r\n        iDay = parseInt(this.dayValueId.attr(\"data\") || this._options.defDay),\r\n        iMinYear = parseInt(this._options.minYear),\r\n        iMaxYear = parseInt(this._options.maxYear);\r\n\r\n        this.Year = parseInt(this.yearValueId.attr(\"data\") || this._options.defYear) || dt.getFullYear();\r\n        this.Month = 1 <= iMonth && iMonth <= 12 ? iMonth : dt.getMonth() + 1;\r\n        this.Day = iDay > 0 ? iDay : dt.getDate();\r\n        this.minYear = iMinYear && iMinYear < this.Year ? iMinYear : this.Year;\r\n        this.maxYear = iMaxYear && iMaxYear > this.Year ? iMaxYear : this.Year;\r\n\r\n        //初始化控件\r\n        //设置年\r\n        setSelectControl(this.yearValueId, this.minYear, this.maxYear - this.minYear + 1, this.Year);\r\n        //设置月\r\n        setSelectControl(this.monthValueId, 1, 12, this.Month);\r\n        //设置日\r\n        var daysInMonth = new Date(this.Year, this.Month, 0).getDate(); //获取指定年月的当月天数[new Date(year, month, 0).getDate()]\r\n        if (this.Day > daysInMonth) { this.Day = daysInMonth; };\r\n        setSelectControl(this.dayValueId, 1, daysInMonth, this.Day);\r\n\r\n        var oThis = this;\r\n        //绑定控件事件\r\n        this.yearValueId.change(function () {\r\n            oThis.Year = $(this).val();\r\n            setSelectControl(oThis.monthValueId, 1, 12, oThis.Month);\r\n            oThis.monthValueId.change();\r\n        });\r\n        this.monthValueId.change(function () {\r\n            oThis.Month = $(this).val();\r\n            var daysInMonth = new Date(oThis.Year, oThis.Month, 0).getDate();\r\n            if (oThis.Day > daysInMonth) { oThis.Day = daysInMonth; };\r\n            setSelectControl(oThis.dayValueId, 1, daysInMonth, oThis.Day);\r\n        });\r\n        this.dayValueId.change(function () {\r\n            oThis.Day = $(this).val();\r\n        });\r\n    }\r\n})(jQuery);"],"sourceRoot":"/source/"}