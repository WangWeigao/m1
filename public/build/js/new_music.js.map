{"version":3,"sources":["music.js","dateSelector.js"],"names":[],"mappings":"AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AC9JA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"new_music.js","sourcesContent":["$(document).ready(function() {\r\n    /**\r\n     * 点击新建按钮\r\n     */\r\n    $(\"#createMusic\").click(function() {\r\n        ajaxSubmitForm();\r\n        function ajaxSubmitForm() {\r\n           var value = $(\"#midi-file\").val();\r\n           if (isEmpty(value)) {\r\n               alert(\"请先选择文件\");\r\n               return false;\r\n           }\r\n           function isEmpty( inputStr ) {\r\n               if ( null == inputStr || \"\" == inputStr ) {\r\n                   return true;\r\n               }\r\n               return false;\r\n            }\r\n           if (!value.match(/.mid/i)) {\r\n               alert(\"文件格式错误\");\r\n               return false;\r\n           }\r\n           var option = {\r\n               url : 'music',\r\n               type : 'POST',\r\n               dataType : 'json',\r\n               data: {\r\n                   'name': $(\"#title\").val(),\r\n                   'author': $(\"#author\").val()\r\n               },\r\n               headers : {\r\n                //    \"ClientCallMode\" : \"ajax\"\r\n                   'X-CSRF-TOKEN': $('input[name=\"_token\"]').val()\r\n               }, //添加请求头部\r\n               success : function(data) {\r\n                   $(\"#addResult\").html(\"添加成功\");\r\n                   $(\"#addResult\").hide('slow', function() {\r\n\r\n                   });\r\n\r\n               },\r\n               error : function(data) {\r\n                   alert(JSON.stringify(data) + \"--上传失败,请刷新后重试\");\r\n               }\r\n           };\r\n           $(\"#add_music\").ajaxSubmit(option);\r\n           return false; //最好返回false，因为如果按钮类型是submit,则表单自己又会提交一次;返回false阻止表单再次提交\r\n        }\r\n    });\r\n\r\n    // 点击\"编辑\"按钮\r\n    $(\".edit\").each(function(index, el) {\r\n        $(this).click(function() {\r\n            $(\"#edit_id\").val($(el).closest('tr').attr('id'));\r\n            $(\"#edit_title\").val($(el).closest('tr').find('td:eq(0)').text());\r\n            $(\"#edit_author\").val($(el).closest('tr').find('td:eq(1)').text());\r\n        });\r\n    });\r\n\r\n    // 点击\"保存修改\"按钮\r\n    $(\"#save\").bind('click', function(event) {\r\n        ajaxSubmitForm();\r\n        function ajaxSubmitForm() {\r\n            var $id_value = $(\"#edit_id\").val();\r\n            var option = {\r\n                url : 'music/' + $id_value,\r\n                type : 'put',\r\n                dataType : 'json',\r\n                data : {\r\n                    'name' : $(\"#edit_title\").val(),\r\n                    'author' : $(\"#edit_author\").val()\r\n                },\r\n                headers : {\r\n                    'X-CSRF-TOKEN': $('input[name=\"_token\"]').val()\r\n                },\r\n                success : function(data) {\r\n                    $(\"#addResult\").html(\"修改成功!\");\r\n                },\r\n                error : function(data) {\r\n                    alert('哦，出了点小问题，再试一次吧');\r\n                }\r\n                // error : function(data) {\r\n                //     alert(JSON.stringify(data) + \"--添加失败, 请重试\");\r\n                // }\r\n            }\r\n            $(\"#save_detail\").ajaxSubmit(option);\r\n            return false;\r\n        }\r\n    });\r\n\r\n    // 点击\"删除\"按钮\r\n    $(\".delete\").each(function(indel, el) {\r\n        $(this).bind('click', function(event) {\r\n            $.ajax({\r\n                url: '/music/' + $(el).closest('tr').attr('id'),\r\n                type: 'DELETE',\r\n                dataType: 'json',\r\n                headers : {\r\n                    'X-CSRF-TOKEN': $('input[name=\"_token\"]').val()\r\n                }\r\n            })\r\n            .done(function() {\r\n                console.log(\"success\");\r\n                $(el).closest('tr').remove();\r\n\r\n            })\r\n            .fail(function() {\r\n                console.log(\"error\");\r\n            })\r\n            .always(function() {\r\n                console.log(\"complete\");\r\n            });\r\n        });\r\n    });\r\n\r\n    /**\r\n     * 自动拉取筛选待件\r\n     */\r\n    $.ajax({\r\n        url: '/music/condations',\r\n        type: 'GET',\r\n        dataType: 'json',\r\n        headers : {\r\n            'X-CSRF-TOKEN': $('input[name=\"_token\"]').val()\r\n        }\r\n    })\r\n    .done(function(data) {\r\n        console.log(\"success\");\r\n        $.each(data, function(n, value) {\r\n            var $str = \"\";\r\n            $str = \"<option value=\" + value.id + \">\" + value.name + \"</option>\";\r\n            $(\"#instruments\").append($str);\r\n        });\r\n    })\r\n    .fail(function(data) {\r\n        console.log(data);\r\n    })\r\n    .always(function() {\r\n        console.log(\"complete\");\r\n    });\r\n\r\n    /**\r\n     * select下拉式日期选择器\r\n     */\r\n     $(\"#calendar\").dateSelector({\r\n         ctlYearId: null,\r\n         ctlMonthId: null,\r\n         ctlDayId: null,\r\n         defYear: 2000,\r\n         defMonth: 2,\r\n         defDay: 1,\r\n         minYear: 1882,\r\n         maxYear: 3000\r\n });\r\n\r\n\r\n\r\n});\r\n","/*\n * jQuery Date Selector Plugin\n * 日期联动选择插件\n *\n * Demo:\n        $(\"#calendar\").DateSelector({\n                ctlYearId: <年控件id>,\n                ctlMonthId: <月控件id>,\n                ctlDayId: <日控件id>,\n                defYear: <默认年>,\n                defMonth: <默认月>,\n                defDay: <默认日>,\n                minYear: <最小年|默认为1882年>,\n                maxYear: <最大年|默认为本年>\n        });\n\n   HTML:<div id=\"calendar\"><SELECT id=idYear></SELECT>年 <SELECT id=idMonth></SELECT>月 <SELECT id=idDay></SELECT>日</div>\n */\n(function ($) {\n    //SELECT控件设置函数\n    function setSelectControl(oSelect, iStart, iLength, iIndex) {\n        oSelect.empty();\n        for (var i = 0; i < iLength; i++) {\n            if ((parseInt(iStart) + i) == iIndex)\n                oSelect.append(\"<option selected='selected' value='\" + (parseInt(iStart) + i) + \"'>\" + (parseInt(iStart) + i) + \"</option>\");\n            else\n                oSelect.append(\"<option value='\" + (parseInt(iStart) + i) + \"'>\" + (parseInt(iStart) + i) + \"</option>\");\n        }\n    }\n\n    $.fn.DateSelector = function (options) {\n        options = options || {};\n\n        //初始化\n        this._options = {\n            ctlYearId: null,\n            ctlMonthId: null,\n            ctlDayId: null,\n            defYear: 0,\n            defMonth: 0,\n            defDay: 0,\n            minYear: 1882,\n            maxYear: new Date().getFullYear()\n        }\n\n        for (var property in options) {\n            this._options[property] = options[property];\n        }\n\n        this.yearValueId = $(\"#\" + this._options.ctlYearId);\n        this.monthValueId = $(\"#\" + this._options.ctlMonthId);\n        this.dayValueId = $(\"#\" + this._options.ctlDayId);\n\n        var dt = new Date(),\n        iMonth = parseInt(this.monthValueId.attr(\"data\") || this._options.defMonth),\n        iDay = parseInt(this.dayValueId.attr(\"data\") || this._options.defDay),\n        iMinYear = parseInt(this._options.minYear),\n        iMaxYear = parseInt(this._options.maxYear);\n\n        this.Year = parseInt(this.yearValueId.attr(\"data\") || this._options.defYear) || dt.getFullYear();\n        this.Month = 1 <= iMonth && iMonth <= 12 ? iMonth : dt.getMonth() + 1;\n        this.Day = iDay > 0 ? iDay : dt.getDate();\n        this.minYear = iMinYear && iMinYear < this.Year ? iMinYear : this.Year;\n        this.maxYear = iMaxYear && iMaxYear > this.Year ? iMaxYear : this.Year;\n\n        //初始化控件\n        //设置年\n        setSelectControl(this.yearValueId, this.minYear, this.maxYear - this.minYear + 1, this.Year);\n        //设置月\n        setSelectControl(this.monthValueId, 1, 12, this.Month);\n        //设置日\n        var daysInMonth = new Date(this.Year, this.Month, 0).getDate(); //获取指定年月的当月天数[new Date(year, month, 0).getDate()]\n        if (this.Day > daysInMonth) { this.Day = daysInMonth; };\n        setSelectControl(this.dayValueId, 1, daysInMonth, this.Day);\n\n        var oThis = this;\n        //绑定控件事件\n        this.yearValueId.change(function () {\n            oThis.Year = $(this).val();\n            setSelectControl(oThis.monthValueId, 1, 12, oThis.Month);\n            oThis.monthValueId.change();\n        });\n        this.monthValueId.change(function () {\n            oThis.Month = $(this).val();\n            var daysInMonth = new Date(oThis.Year, oThis.Month, 0).getDate();\n            if (oThis.Day > daysInMonth) { oThis.Day = daysInMonth; };\n            setSelectControl(oThis.dayValueId, 1, daysInMonth, oThis.Day);\n        });\n        this.dayValueId.change(function () {\n            oThis.Day = $(this).val();\n        });\n    }\n});\n"],"sourceRoot":"/source/"}